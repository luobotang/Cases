define("w-preview",[],function(){function t(t){var n=t.split("-");return e.replace("{img}","cases/"+t+"/正面-微笑.jpg").replace("{name}",n[1]).replace("{date}",n[0])}var e="<div class='preview_img_wrapper'><img src='{img}'></img></div><div class='preview_info'><p>姓名：<span class='name'>{name}</span></p><p>初诊日期：<span class='date'>{date}</span></p></div>";return{create:function(e){return $("<div>",{"class":"case_preview fix-float"}).html(t(e))}}}),define("w-query",["w-preview"],function(e){function a(e){u.html(e),u.show()}function f(){u.hide()}function l(t){o.html(""),o.append(e.create(t)),o.show()}function c(){o.hide()}function h(e){e&&e.length?(s.html(e.reduce(function(e,t){return e+"<li>"+t+"</li>"},"<ul>")+"</ul>"),s.show()):p()}function p(){s.hide()}var t=$("<div>",{"class":"query_imgbg"}),n=$("<div>",{"class":"query"}),r=$("<input>",{"class":"query_condition",placeholder:"输入查询对象的就诊日期、姓名，例如：20140101 王伟"}),i=$("<span>",{"class":"query_go"});r.appendTo(n),i.appendTo(n);var s=$("<div>",{"class":"prompt",click:function(e){var t=e.target,n;t.tagName==="LI"&&(n=t.innerHTML.replace(/<[^>]*>/g,""),r.val(n),l(n),p())}}),o=$("<div>"),u=$("<div>",{"class":"query_message",click:function(){u.hide()}});return{init:function(e,t){i.click(function(){p(),f(),e(r.val())}),r.keyup(function(){var e=r.val().trim();c(),f(),e?h(t(e)):p()}),p(),f(),c()},appendTo:function(e){$(e).addClass("case_query").append(t,n,s,o,u)},showMessage:a}}),define("m-case_query",[],function(){function t(t,n){$.get("cases/caselist.txt",function(n){e=n.split("\r\n"),e.sort(),$.isFunction(t)&&t(e)}).fail(function(){$.isFunction(n)&&n()})}function n(t,n){n=n||function(e){return"<em>"+e+"</em>"};var r=t.split(/\s+/);return!r||!r.length?[]:e.reduceRight(function(e,t){var i=0,s=0,o=r.reduce(function(e,t){return e.search(t)>=0?(i++,e.replace(t,n)):(s++,e)},t);return i+s>0&&i>=s&&e.push(o),e},[])}function r(n,s,o){if(e){var u=i(n);u?$.isFunction(s)&&s(u):$.isFunction(o)&&o(u)}else t(function(){r(n,s,o)},o)}function i(t){t=t.trim();for(var n=e.length-1;n>=0;n--){var r=e[n];if(r===t)return"cases/"+r+"/"}return null}function s(e,t,n){r(e,function(e){$.getJSON(e+"case.txt",function(n){t(n,e)}).fail(n)},n)}var e;return t(),{queryPath:r,getCaseInfo:s,getCasePaths:n}}),require(["w-query","m-case_query"],function(e,t){function r(n){t.queryPath(n,function(t){t?window.open("case.htm?p="+n):e.showMessage("没有找到相关的信息，检查一下是否输入有误？")})}var n=document.getElementById("query");e.init(r,t.getCasePaths),e.appendTo(n)}),define("index.main",function(){});